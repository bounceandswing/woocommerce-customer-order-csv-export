"use strict";(function(){jQuery(document).ready(function(s){var i,t,r,o,n,c,a,d,_,l,u,e,m,p,f,v,h,w,x,g;return v={},o=s.WCBackboneModal.View,g=function(o,r,n,c,a,s){var i,d,_;return _=o.length,a=a||25,s=s||_,d=0,i=function(){var e,t;for(t=+new Date,e=d;d<_&&d-e<s&&new Date-t<50;)r.call(n,o[d]),d+=1;return d<_?setTimeout(i,a):c(o)},setTimeout(i,25)},h=function(e){var t,r;return r={},t=function(e,t){var o;t.name=t.name.replace("[]",""),null!=(o=r[t.name])?s.isArray(o)?o.push(t.value):r[t.name]=[o,t.value]:r[t.name]=t.value},s.each(s(e).serializeArray(),t),r},w=function(e){return s("#wc-backbone-modal-dialog .modal-close").trigger("click"),e.button_class=e.button_class||"",new o({target:"wc-customer-order-csv-export-modal",string:e})},_=function(e,t,o){var r,n;return r={action:"wc_customer_order_csv_export_create_export",security:wc_customer_order_csv_export_admin.create_export_nonce,export_type:t||"orders",export_query:e,export_method:o||"download"},n=wp.template("wc-customer-order-csv-export-modal-body-export-started"),w({title:wc_customer_order_csv_export_admin.i18n.export_started,body:n({export_method:o}),action:wc_customer_order_csv_export_admin.is_batch_enabled?wc_customer_order_csv_export_admin.i18n.cancel:wc_customer_order_csv_export_admin.i18n.close,button_class:wc_customer_order_csv_export_admin.is_batch_enabled?"cancel-export":""}),s.post(ajaxurl,r).done(function(t){var o;if(s("#wc-backbone-modal-dialog").length)return!1===t.success?u({title:t.data.title,message:t.data.message}):(s("#wc-backbone-modal-dialog").addClass("wc-customer-order-csv-export-"+t.export_id).data("wc-customer-order-csv-export-id",t.export_id),wc_customer_order_csv_export_admin.is_batch_enabled?d(t.export_id):(o=!1,v[t.export_id]=setInterval(function(){if(!o)return o=!0,s.get(t.status_url).done(function(e){return"string"==typeof e?u():(o=!1)===e.success?(a(t.export_id),u(e.data)):"completed"===e.data.status?l(e.data):void 0}).fail(function(e,t,o){return u()})},2e3)))}).fail(function(e,t,o){return u()})},f=function(e){var t,o,r;return r=wp.template("wc-customer-order-csv-export-modal-body-export-started"),w({title:wc_customer_order_csv_export_admin.i18n.export_resumed,body:r({export_method:"download"})}),t=s(".file_actions .resume[data-export-id="+e+"]").parents("tr"),(o=t.find(".export_status mark")).removeClass("paused").addClass("processing"),t.find(".file_actions .resume").addClass("disabled").attr("href","").blur(),t.find(".file_actions .cancel").removeClass("cancel").addClass("delete"),d(e).then(function(e){return o.removeClass("processing").addClass(e),t.find(".file_actions .resume").removeClass("disabled").removeClass("resume").addClass("download")})},d=function(t){return window.onbeforeunload=function(){return wc_customer_order_csv_export_admin.i18n.confirm_export_cancel},s(document).on("wc_customer_order_csv_export_background_export_batch_progress_"+t,function(e,t){return s(".wc-customer-order-csv-export-progress").val(t.percentage)}),s(document).on("click","#btn-ok.cancel-export",function(e){if(confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return window.onbeforeunload=null,wc_customer_order_csv_export_background_export_batch_handler.cancelled=t}),wc_customer_order_csv_export_background_export_batch_handler.process_job(t).then(function(e){return window.onbeforeunload=null,s(".wc-customer-order-csv-export-progress").val(100),l(e.data)}).catch(function(e){return s(".wc-customer-order-csv-export-progress").hide(),u(e.data)})},l=function(e){var t;if("download"===e.method||"local"===e.method||"completed"===e.transfer_status)return t=wp.template("wc-customer-order-csv-export-modal-body-export-completed"),w({title:wc_customer_order_csv_export_admin.i18n.export_completed,body:t({export_method:e.method,download_url:e.download_url}),action:wc_customer_order_csv_export_admin.i18n.done}),"download"===e.method&&(window.location.href=e.download_url),a(e.export_id),e.status},u=function(e){var t,o,r,n=0<arguments.length&&void 0!==e?e:null;if(r=wc_customer_order_csv_export_admin.i18n.unexpected_error,t=wc_customer_order_csv_export_admin.i18n.unexpected_error_message,(o=null)!=n){if(null!=n.status)switch(o=n.status,n.status){case"not-found":r=wc_customer_order_csv_export_admin.i18n.export_not_found;break;case"failed":r=wc_customer_order_csv_export_admin.i18n.export_failed;break;case"completed":r="failed"===n.transfer_status?wc_customer_order_csv_export_admin.i18n.export_transfer_failed:wc_customer_order_csv_export_admin.i18n.export_completed}else null!=n.title&&(r=n.title);null!=n.message&&(t=n.message)}return w({title:r,body:'<p><span class="dashicons dashicons-warning"></span> '+t+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}),o},a=function(e){return s.get(ajaxurl,{action:"wc_plugin_framework_customer_order_csv_export_dismiss_notice",messageid:"wc_customer_order_csv_export_finished_"+e})},wc_customer_order_csv_export_admin.settings_page===pagenow&&("export"===wc_customer_order_csv_export_admin.current_tab&&(e={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_csv_export_admin.calendar_icon_url,buttonImageOnly:!0},s("#start_date").datepicker(e),s("#end_date").datepicker(e),(r=s(".show_if_coupons").closest("tr")).hide(),s("input[name=type]").change(function(){var e,t,o;return t=s(".show_if_orders").closest("tr").add(s("#subscription_orders").closest("table.form-table")).add(s("#subscription_orders").closest("table.form-table").prev("h2")),o=s("#start_date").closest("tr"),e=s("#end_date").closest("tr"),"coupons"===s(this).val()?(r.show(),t.hide(),o.hide(),e.hide()):("customers"===s(this).val()?(r.hide(),t.hide()):(r.hide(),t.show()),o.show(),e.show())}),s("#mainform").submit(function(e){var t,o;return e.preventDefault(),t=(o=h(this)).type,delete o.type,_(o,t,"download")})),"export_list"===wc_customer_order_csv_export_admin.current_tab&&(s(".file_actions").find(".delete").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_delete))return e.preventDefault()}),s(".file_actions").find(".cancel").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return e.preventDefault()}),s(".file_actions").find(".transfer, .email").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_transfer))return e.preventDefault()}),s(".file_actions").find(".resume").on("click",function(e){if(e.preventDefault(),!s(e.target).hasClass("disabled"))return f(s(e.target).data("export-id"))})),"settings"===wc_customer_order_csv_export_admin.current_tab&&(t={ftp:s(".js-auto-export-ftp-field:first").closest("table"),http_post:s(".js-auto-export-http-post-field:first").closest("table"),email:s(".js-auto-export-email-field:first").closest("table")},s(".js-auto-export-trigger").change(function(){var e,t;return t=s(this).val(),e=s(".js-auto-export-schedule-field").closest("tr"),"immediate"===t?e.hide():e.show()}).change(),s(".js-auto-export-method").change(function(){var e,r;return r=s(this).val(),e=s(this).closest("tr").nextUntil("h3"),"disabled"===r?e.hide():(e.show(),s(".js-auto-export-trigger").change()),"local"===r?s(this).next("span.description").show():s(this).next("span.description").hide(),s.each(t,function(e,t){var o;return t[o=e===r?"show":"hide"]().prev()[o]()})}).change(),s(".js-auto-export-timepicker").timepicker({step:5}),s("select.js-auto-export-ftp-security").change(function(){var e,t,o;if(e=s(".js-auto-export-ftp-port"),t=Number(e.val(),10),o=s(this).val(),""===t||-1<[21,22,990].indexOf(t))return"sftp"===o?e.val(22):"ftp_ssl"===o?e.val(990):e.val(21)}).change(),s(".js-auto-export-test-button").on("click",function(){return s("<input>").attr({type:"hidden",id:"wc_customer_order_csv_export_test_method",name:"wc_customer_order_csv_export_test_method",value:s(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_csv_export_admin.current_tab&&(s(".format_actions").find(".delete:not(.disabled)").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_format_delete))return e.preventDefault()}),wc_customer_order_csv_export_admin.display_load_mapping_modal&&w({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:s("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"}),x=wp.template("wc-customer-order-csv-export-modal-body-select-custom-format"),wc_customer_order_csv_export_admin.display_select_custom_format_modal&&w({title:wc_customer_order_csv_export_admin.i18n.custom_format_saved,body:x({custom_export_format:wc_customer_order_csv_export_admin.custom_format_key}),action:wc_customer_order_csv_export_admin.i18n.custom_format_update_settings,cancel:wc_customer_order_csv_export_admin.i18n.custom_format_keep_settings,button_class:"button-primary"}),s(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(e){var t,o,r;t=s(this).closest("table"),o=s(this).prop("checked"),r=e.shiftKey||s(this).data("wp-toggle"),t.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!s(this).is(":hidden,:disabled")&&(r?!s(this).prop("checked"):!!o)}),t.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!r&&!!o})}),s(".js-row-type").change(function(){var e,t,o,r;return r=s(".js-show-if-single-order-format").closest("tr"),o=(e=s("select.js-field-key")).find('option[value="line_items"]'),t=e.find('option[value^="item_"]'),"order"===s(this).val()?(r.show(),o.prop("disabled",!1),t.prop("disabled",!0)):(r.hide(),o.prop("disabled",!0),t.prop("disabled",!1),s("#items_format").val("pipe_delimited").change()),e.not('[name*="[__INDEX__]"]').removeClass("enhanced").select2("destroy"),s(document.body).trigger("wc-enhanced-select-init")}).change(),i=s(".wc-customer-order-csv-export-field-mapping"),n=function(e,t){var o,r,n,c=0<arguments.length&&void 0!==e?e:{},a=1<arguments.length&&void 0!==t&&t;if(r=i.find(".field-mapping-__INDEX__"),n=i.find("tbody tr").length-2,(o=s(r.prop("outerHTML").replace(/__INDEX__/g,n))).find(".enhanced").removeClass("enhanced"),c.key&&(o.find(".js-field-key").val(c.key),"meta"===c.key?(o.find(".js-field-meta-key-label").show(),c.meta_key&&o.find(".js-field-meta-key").val(c.meta_key)):"static"===c.key&&(o.find(".js-field-static-value-label").show(),c.static_value&&o.find(".js-field-static-value").val(c.static_value))),c.name&&o.find(".js-field-name").val(c.name),r.before(o),i.find(".no-field-mappings").addClass("hide"),i.find("tfoot .js-remove-field-mapping").removeClass("hide"),a)return s(document.body).trigger("wc-enhanced-select-init")},p=function(e,t,o){var r,n=1<arguments.length&&void 0!==t?t:400,c=2<arguments.length&&void 0!==o?o:null;return c=c||function(){},r=function(){return i.find("tbody tr:visible").length<1&&(i.find(".no-field-mappings").removeClass("hide"),i.find(".js-remove-field-mapping").addClass("hide")),i.find('th.check-column input[type="checkbox"]').removeAttr("checked")},n?s.when(s(e).closest("tr.field-mapping").fadeOut(n,function(){var e;return e=s(this),setTimeout(function(){return e.remove()},1)})).then(function(){return r(),setTimeout(c,1)}):(s(e).closest("tr.field-mapping").remove(),r(),c())},m=function(){var r;return r=0,i.find("tr.field-mapping").each(function(e,t){if(!s(t).hasClass("field-mapping-__INDEX__"))return s(t).removeClass(function(e,t){var o,r;if(r=new RegExp("field-mapping-([0-9])*","g"),o=t.match(r))return o[0]}),s(t).addClass("field-mapping-"+r),s("input, select, textarea",t).each(function(e,t){var o;if((o=jQuery(t)).attr("name"))return o.attr("name",o.attr("name").replace(/\[([^[]*)\]/,"["+r+"]"))}),r++})},c=function(t){return s(".wc-customer-order-csv-export-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var e;return t="string"==typeof t?JSON.parse(t):t,s(".js-include-all-meta").prop("checked",!0===t.include_all_meta),t.delimiter&&s(".js-row-type").val(t.row_type).trigger("change"),t.row_type&&s(".js-row-type").length&&s(".js-row-type").val(t.row_type).trigger("change"),t.items_format&&s(".js-items-format").length&&s(".js-items-format").val(t.items_format).trigger("change"),p(i.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),e=s.map(t.columns,function(e,t){return"string"==typeof e&&(e={name:e}),e.key||(e.key=t),e}),g(e,n,this,function(){return m(),s(document.body).trigger("wc-enhanced-select-init"),s(".wc-customer-order-csv-export-field-mapping").unblock()})},1)},i.find(".js-add-field-mapping").click(function(e){return e.preventDefault(),n({},!0)}),i.find(".js-remove-field-mapping").click(function(e){var t;return e.preventDefault(),t=i.find('tbody input[type="checkbox"]:checked'),p(t,null,m)}),i.find(".js-load-mapping").click(function(e){return e.preventDefault(),w({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:s("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"})}),s(document.body).on("change","#load-mapping-source",function(e){return"snippet"===s(e.target).val()?s("#load-mapping-snippet").show():s("#load-mapping-snippet").hide()}),s(document.body).on("wc_backbone_modal_response",function(e,t,o){var r,n;if(o.format?(r={action:"wc_customer_order_csv_export_select_export_format",security:wc_customer_order_csv_export_admin.select_format_nonce,export_type:o.export_type||"orders",export_format:o.format},s.post(ajaxurl,r).done(function(e){if(!1===e.success)return u({message:wc_customer_order_csv_export_admin.i18n.custom_format_select_error})}).fail(function(e,t,o){return u({message:wc_customer_order_csv_export_admin.i18n.custom_format_select_error})})):n="snippet"===o.source?o.snippet?JSON.parse(o.snippet):{columns:{}}:"empty"===o.source?{columns:{}}:wc_customer_order_csv_export_admin.export_formats[o.source],n)return setTimeout(function(){return c(n)},1)}),i.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:m}),i.on("change","select.js-field-key",function(e){var t,o,r,n,c;if(r=(t=s(e.target)).closest("tr").find(".js-field-name"),o=t.closest("td").find(".js-field-meta-key-label"),n=t.closest("td").find(".js-field-static-value-label"),"meta"===t.val()?o.removeClass("hide").find("input").focus():o.addClass("hide").find("input").val(""),"static"===t.val()?n.removeClass("hide").find("input").focus():n.addClass("hide").find("input").val(""),!r.val()||e.removed&&e.removed.id===r.val())return c="meta"===t.val()?"":t.val(),r.val(c)}),s("#mainform").submit(function(e){return s("tr.field-mapping-__INDEX__").remove()}))),"edit-shop_order"===pagenow&&(s('#posts-filter input[type="submit"].action').on("click",function(e){var t,o,r;if("download_to_csv"===(t=s(e.target).prev("select").val())||"export_to_csv_via_auto_export_method"===t)return e.preventDefault(),r="download_to_csv"===t?"download":"auto_export",o=s.map(s("#posts-filter").find('input[name="post[]"]:checked'),function(e){return Number(s(e).val(),10)}),_({ids:o},"orders",r)}),s(".order_actions .download_to_csv, .wc_actions .download_to_csv").on("click",function(e){var t;return e.preventDefault(),t=s(this).closest("tr").find('th input[name="post[]"]').val(),_({ids:t},"orders","download")})),"shop_order"===pagenow&&s("form#post").submit(function(e){var t,o,r;if((t=s(this).find('select[name="wc_order_action"]').val())&&-1!==["wc_customer_order_csv_export_download","wc_customer_order_csv_export_via_auto_export_method"].indexOf(t))return e.preventDefault(),r="wc_customer_order_csv_export_download"===t?"download":"auto_export",o=[woocommerce_admin_meta_boxes.post_id],_({ids:o},"orders",r)}),"users"===pagenow&&s(".bulkactions #doaction").on("click",function(e){var t,o,r;if("download_to_csv"===(t=s(e.target).prev("select").val())||"export_to_csv_via_auto_export_method"===t)return e.preventDefault(),r="download_to_csv"===t?"download":"auto_export",o=s.map(s(".wp-list-table.users").find('input[name="users[]"]:checked'),function(e){return Number(s(e).val(),10)}),_({ids:o},"customers",r)}),s("body").on("wc_backbone_modal_before_remove",function(e){var t;if((t=s("#wc-backbone-modal-dialog").data("wc-customer-order-csv-export-id"))&&v[t])return clearInterval(v[t])})})}).call(void 0);